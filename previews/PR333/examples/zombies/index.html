<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Zombie Outbreak · Agents.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Agents.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Agents.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../schelling/">Schelling&#39;s segregation model</a></li><li><a class="tocitem" href="../sugarscape/">Sugarscape</a></li><li><a class="tocitem" href="../sir/">SIR model for the spread of COVID-19</a></li><li><a class="tocitem" href="../social_distancing/">Continuous space social distancing for COVID-19</a></li><li><a class="tocitem" href="../wealth_distribution/">Wealth distribution</a></li><li><a class="tocitem" href="../forest_fire/">Forest fire</a></li><li><a class="tocitem" href="../game_of_life_2D_CA/">Conway&#39;s game of life</a></li><li><a class="tocitem" href="../wright-fisher/">Wright-Fisher model of evolution</a></li><li><a class="tocitem" href="../hk/">Hegselmann-Krause opinion dynamics</a></li><li><a class="tocitem" href="../flock/">Flocking</a></li><li><a class="tocitem" href="../daisyworld/">Daisyworld</a></li><li><a class="tocitem" href="../predator_prey/">Predator-Prey</a></li><li><a class="tocitem" href="../growing_bacteria/">Bacteria Growth</a></li><li><a class="tocitem" href="../opinion_spread/">Opinion spread</a></li><li class="is-active"><a class="tocitem" href>Zombie Outbreak</a><ul class="internal"><li><a class="tocitem" href="#Constructing-the-end-of-days"><span>Constructing the end of days</span></a></li><li><a class="tocitem" href="#Visualising-the-fall-of-humanity"><span>Visualising the fall of humanity</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../models/">Predefined Models</a></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../interact/">Interactive application</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Ecosystem Integration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../schoolyard/">LightGraphs</a></li><li><a class="tocitem" href="../diffeq/">DifferentialEquations</a></li><li><a class="tocitem" href="../optim/">BlackBoxOptim</a></li></ul></li><li><a class="tocitem" href="../../comparison/">ABM Framework Comparison</a></li><li><a class="tocitem" href="../../devdocs/">Developer Docs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Zombie Outbreak</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Zombie Outbreak</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDynamics/Agents.jl/blob/master/examples/zombies.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Zombie-Outbreak"><a class="docs-heading-anchor" href="#Zombie-Outbreak">Zombie Outbreak</a><a id="Zombie-Outbreak-1"></a><a class="docs-heading-anchor-permalink" href="#Zombie-Outbreak" title="Permalink"></a></h1><p><img src="outbreak.gif" alt/></p><p>This model showcases an ABM running on a map, using <a href="examples/@gif"><code>OpenStreetMapSpace</code></a>.</p><h2 id="Constructing-the-end-of-days"><a class="docs-heading-anchor" href="#Constructing-the-end-of-days">Constructing the end of days</a><a id="Constructing-the-end-of-days-1"></a><a class="docs-heading-anchor-permalink" href="#Constructing-the-end-of-days" title="Permalink"></a></h2><pre><code class="language-julia">using Agents</code></pre><p>We&#39;ll simulate a zombie outbreak in a city. To do so, we start with an agent which satisfies the OSMSpace conditions of having a position of type <a href="examples/@ref"><code>OSMPos</code></a> and a <code>route</code> vector.</p><pre><code class="language-julia">mutable struct Zombie &lt;: AbstractAgent
    id::Int # Required
    pos::OSMPos # Required
    route::Vector{Int} # Required
    infected::Bool # User added
end</code></pre><p>The model constructor we build consists of a map, and 100 agents scattered randomly around it. They have their own agenda and need to travel to some new destination. Unfortunately one of the population has turned and will begin infecting anyone who comes close.</p><pre><code class="language-julia">function initialise(; map_path = &quot;test/data/reno_east3.osm&quot;)
    model = ABM(Zombie, OpenStreetMapSpace(map_path))

    for _ in 1:100
        start = random_direction(model) # Somewhere on a road
        finish = random_position(model) # At an intersection

        # We already have our start and finish edges, so we identify the in-between
        path = plan_route(start[2], finish[1], model)
        # Since we start on an edge, there are two possibilities here.
        # 1. The route wants us to turn around, thus next id en-route will
        # be pos[1]. That&#39;s fine.
        # 2. The route wants us to move on, but start will be in the list,
        # so we need to drop that.
        path[1] == start[2] &amp;&amp; popfirst!(path)

        add_agent!(start, model, path, false)
    end

    patient_zero = random_agent(model)
    patient_zero.infected = true
    return model
end</code></pre><pre class="documenter-example-output">initialise (generic function with 1 method)</pre><p>In our model, agents are seemingly oblivious to the problem, they keep going about their business, but start eating people along the way. Perhaps they can finally express their distaste for city commuting.</p><pre><code class="language-">function agent_step!(agent, model)</code></pre><p>Each agent will progress 25 meters along their route</p><pre><code class="language-">    move_agent!(agent, model, 25)

    if agent.pos[1] == agent.pos[2] &amp;&amp; length(agent.route) == 0 &amp;&amp; rand() &lt; 0.1</code></pre><p>When stationary, give the agent a 10% chance of going somwhere else</p><pre><code class="language-">        agent.route = plan_route(agent.pos[1], random_position(model)[1], model)</code></pre><p>Drop current position</p><pre><code class="language-">        popfirst!(agent.route)</code></pre><p>Start on new route</p><pre><code class="language-">        move_agent!(agent, OSMPos(agent.pos[1], popfirst!(agent.route)), model)
    end

    if agent.infected</code></pre><p>Agents will be infected if they get within 50 meters of a zombie.</p><pre><code class="language-">        map(i -&gt; model[i].infected = true, nearby_ids(agent, model, 50))
    end
end</code></pre><h2 id="Visualising-the-fall-of-humanity"><a class="docs-heading-anchor" href="#Visualising-the-fall-of-humanity">Visualising the fall of humanity</a><a id="Visualising-the-fall-of-humanity-1"></a><a class="docs-heading-anchor-permalink" href="#Visualising-the-fall-of-humanity" title="Permalink"></a></h2><p>Plotting this space in a seemless manner is a work in progress. For now we use <a href="https://github.com/pszufe/OpenStreetMapXPlot.jl">OpenStreetMapXPlot</a> and a custom routine.</p><pre><code class="language-julia">using OpenStreetMapXPlot
using Plots
gr()

ac(agent) = agent.infected ? :green : :black
as(agent) = agent.infected ? 6 : 5

function plotagents(model)
    # Essentially a cut down version on plotabm
    ids = model.scheduler(model)
    colors = [ac(model[i]) for i in ids]
    sizes = [as(model[i]) for i in ids]
    markers = :circle
    pos = [map_coordinates(model[i], model) for i in ids]

    scatter!(
        pos;
        markercolor = colors,
        markersize = sizes,
        markershapes = markers,
        label = &quot;&quot;,
        markerstrokewidth = 0.5,
        markerstrokecolor = :black,
        markeralpha = 0.7,
    )
end</code></pre><pre class="documenter-example-output">plotagents (generic function with 1 method)</pre><p>Let&#39;s see how this plays out!</p><pre><code class="language-">Random.seed!(2490) # hide
model = initialise()

frames = @animate for i in 0:200
    i &gt; 0 &amp;&amp; step!(model, agent_step!, 1)
    plotmap(model.space.m)
    plotagents(model)
end

gif(frames, &quot;outbreak.gif&quot;, fps = 15)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../opinion_spread/">« Opinion spread</a><a class="docs-footer-nextpage" href="../../models/">Predefined Models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 15 October 2020 09:24">Thursday 15 October 2020</span>. Using Julia version 1.5.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
